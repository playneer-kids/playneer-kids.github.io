<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4018994426619685" crossorigin="anonymous"></script>
    <title>Type Master Global</title>
    <style>
        /* [Layout Fix] ä¿®æ”¹ body è¨­å®šï¼Œå…è¨±å‚ç›´æ²å‹•ï¼Œä¸¦æ”¹ç‚ºå‚ç›´æ’åˆ— */
        body { 
            font-family: 'Consolas', 'Courier New', monospace; 
            background-color: #121212; 
            color: #e0e0e0; 
            margin: 0; 
            
            /* é—œéµä¿®æ”¹ï¼šå…è¨±æ²å‹•ï¼Œæ”¹ç‚ºå‚ç›´ä½ˆå±€ */
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            overflow-y: auto; /* å…è¨±å‚ç›´æ²å‹• */
            padding-bottom: 50px; /* ç•™ç©ºé–“çµ¦ Footer */
        }

        /* [Layout Fix] éŠæˆ²ä¸»å®¹å™¨è¨­å®šç‚ºå›ºå®šé«˜åº¦ï¼Œé¿å…è¢«æ–‡å­—æ“ å£“ */
        .main-container { 
            display: flex; 
            width: 100%; 
            max-width: 1600px; 
            height: 90vh; /* ä½”æ“šè¦–çª— 90% é«˜åº¦ */
            flex-shrink: 0; /* é˜²æ­¢è¢«å£“ç¸® */
            border-bottom: 1px solid #333; /* èˆ‡ä¸‹æ–¹æ–‡å­—å€éš” */
        }

        .game-section { flex: 3; display: flex; flex-direction: column; border-right: 2px solid #333; }
        
        .top-bar { background: #1a1a1a; padding: 10px 15px; display: flex; justify-content: flex-end; border-bottom: 1px solid #333; }
        .lang-select { background: #333; color: #fff; border: 1px solid #555; padding: 5px; border-radius: 4px; font-size: 0.9rem; cursor: pointer; }

        .control-panel { background: #1f1f1f; padding: 15px; border-bottom: 3px solid #333; }
        .tabs { display: flex; gap: 10px; margin-bottom: 10px; }
        .tab-btn { background: #333; border: none; color: #aaa; padding: 8px 16px; cursor: pointer; border-radius: 4px 4px 0 0; transition: background 0.2s; }
        .tab-btn:hover { background: #444; }
        .tab-btn.active { background: #2c3e50; color: #fff; font-weight: bold; border-bottom: 2px solid #3498db; }
        .mode-content { display: none; padding: 10px; background: #2c3e50; border-radius: 0 4px 4px 4px; margin-bottom: 10px;}
        .mode-content.active { display: block; }
        input[type="text"], input[type="number"] { padding: 5px; background: #ecf0f1; border: none; border-radius: 3px; color: #2c3e50; font-weight: bold; }
        label { margin-right: 15px; cursor: pointer; display: inline-flex; align-items: center; gap: 5px; }
        select.game-opt { padding: 5px; background: #ecf0f1; border-radius: 3px; color: #2c3e50; font-weight: bold; cursor: pointer;}
        .action-btns { margin-top: 10px; display: flex; gap: 10px; align-items: center; }
        button.start { background: #27ae60; color: white; border: none; padding: 10px 20px; font-size: 1rem; cursor: pointer; border-radius: 4px; }
        button.start:hover { background: #2ecc71; }
        button.stop { background: #c0392b; color: white; border: none; padding: 10px 20px; font-size: 1rem; cursor: pointer; border-radius: 4px; display: none; }
        button.stop:hover { background: #e74c3c; }
        button.small-btn { padding: 3px 8px; font-size: 0.8rem; background: #555; color: white; border: none; border-radius: 3px; cursor: pointer; }
        
        #game-area { position: relative; flex-grow: 1; background: #000; overflow: hidden; }
        #deadline { position: absolute; bottom: 60px; width: 100%; height: 2px; background-color: #e74c3c; box-shadow: 0 0 10px #e74c3c; z-index: 10; }
        #deadline::after { content: "DEADLINE"; position: absolute; right: 10px; top: -20px; color: #e74c3c; font-size: 12px; }
        .falling-char { position: absolute; font-size: 28px; font-weight: bold; color: #00ff00; text-shadow: 0 0 5px #00ff00; user-select: none; }
        .falling-char.missed { color: #555 !important; text-shadow: none; }
        .status-bar { background: #222; padding: 5px 15px; display: flex; justify-content: space-between; font-size: 1.2rem; }
        
        .sidebar { flex: 1.2; background: #1a1a1a; padding: 20px; overflow-y: hidden; min-width: 320px; display: flex; flex-direction: column; }
        .history-controls { background: #252525; padding: 10px; border-radius: 5px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 8px; }
        .history-row { display: flex; justify-content: space-between; align-items: center; }
        .table-container { overflow-y: auto; flex-grow: 1; }
        .score-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .score-table td, .score-table th { padding: 8px 5px; border-bottom: 1px solid #333; text-align: left; }
        .score-table th { color: #f1c40f; position: sticky; top: 0; background: #1a1a1a; }
        .tag { font-size: 0.75rem; padding: 2px 4px; border-radius: 3px; background: #333; margin-left: 2px; color: #aaa; }
        .tag.spd { background: #2980b9; color: white; }
        
        .ad-container { background-color: #2c2c2c; border: 1px dashed #555; margin-bottom: 15px; padding: 10px; text-align: center; color: #888; font-size: 0.8rem; overflow: hidden; }
        .sidebar-ad { min-height: 250px; display: flex; align-items: center; justify-content: center; }
        .banner-ad { width: 100%; min-height: 90px; margin-top: 10px; }

        #game-over-modal { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10, 10, 10, 0.95); padding: 40px; border-radius: 15px; text-align: center; border: 2px solid #f1c40f; z-index: 100; min-width: 300px; }
    </style>
    
    </head>
<body>

<div class="main-container">
    <div class="game-section">
        <div class="top-bar">
            <select id="lang-selector" class="lang-select" onchange="changeLanguage(this.value)">
                <option value="en">English</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ko">í•œêµ­ì–´</option>
                <option value="es">EspaÃ±ol</option>
                <option value="de">Deutsch</option>
                <option value="fr">FranÃ§ais</option>
                <option value="pt">PortuguÃªs</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                <option value="th">à¹„à¸—à¸¢</option>
            </select>
        </div>

        <div class="control-panel">
            <div class="tabs">
                <button id="tab-challenge" class="tab-btn active" onclick="switchMode('challenge')" data-i18n="tab_challenge">Challenge Mode</button>
                <button id="tab-practice" class="tab-btn" onclick="switchMode('practice')" data-i18n="tab_practice">Practice Mode</button>
            </div>

            <div id="panel-challenge" class="mode-content active">
                <label><span data-i18n="lbl_level">Level</span>: <select id="level-select" class="game-opt"></select></label><br><br>
                <span data-i18n="lbl_extra">Extra: </span>
                <label><input type="checkbox" id="chk-digits"> <span data-i18n="chk_digits">Digits (0-9)</span></label>
                <label><input type="checkbox" id="chk-symbols"> <span data-i18n="chk_symbols">Symbols</span></label>
            </div>

            <div id="panel-practice" class="mode-content">
                <p style="margin: 0 0 10px 0; font-size: 0.9rem; color: #bdc3c7;" data-i18n="lbl_practice_tip">Enter characters to practice:</p>
                <input type="text" id="custom-chars" placeholder="..." autocomplete="off" style="width: 250px;">
            </div>

            <div class="action-btns">
                <label><span data-i18n="lbl_speed">Speed</span>: 
                    <select id="speed-select" class="game-opt">
                        <option value="0.8" data-i18n="opt_speed_turtle">ğŸ¢ Turtle</option>
                        <option value="1.5" data-i18n="opt_speed_slow">ğŸš¶ Slow</option>
                        <option value="3" selected data-i18n="opt_speed_std">ğŸƒ Standard</option>
                        <option value="5" data-i18n="opt_speed_fast">ğŸï¸ Fast</option>
                        <option value="8" data-i18n="opt_speed_extreme">ğŸš€ Extreme</option>
                    </select>
                </label>
                
                <button id="btn-start" class="start" onclick="startGame()" data-i18n="btn_start">Start Game</button>
                <button id="btn-stop" class="stop" onclick="stopGame()" data-i18n="btn_stop">â›” Stop Game</button>
            </div>
        </div>

        <div class="status-bar">
            <span style="color: #f1c40f"><span data-i18n="lbl_score">Score</span>: <span id="current-score">0</span></span>
            <span style="color: #3498db"><span data-i18n="lbl_time">Time</span>: <span id="time-left">60</span>s</span>
        </div>

        <div id="game-area">
            <div id="deadline"></div>
        </div>

        <div class="ad-container banner-ad">
            <span>Ads (Banner)</span>
        </div>
    </div>

    <div class="sidebar">
        <h3 style="color: #f1c40f; margin-top:0; border-bottom: 1px solid #555; padding-bottom: 10px;" data-i18n="lbl_history">ğŸ† History</h3>
        
        <div class="ad-container sidebar-ad">
            <span>Ads (Sidebar)</span>
        </div>

        <div class="history-controls">
            <div class="history-row">
                <label style="font-size:0.9rem; margin:0;" data-i18n="lbl_sort">Sort:</label>
                <select id="hist-sort" onchange="renderHistory()" class="game-opt" style="width: 120px; font-size:0.85rem;">
                    <option value="time" data-i18n="opt_sort_time">ğŸ•’ Time</option>
                    <option value="score" data-i18n="opt_sort_score">ğŸ‘‘ Score</option>
                    <option value="level" data-i18n="opt_sort_level">ğŸ†™ Level</option>
                </select>
            </div>
            <div class="history-row">
                <label style="font-size:0.9rem; margin:0;" data-i18n="lbl_filter">Filter Lv:</label>
                <input type="number" id="hist-filter-lv" placeholder="1-52" min="1" max="52" oninput="validateInput(this); renderHistory()" style="width: 110px; font-size:0.85rem;">
            </div>
            <div class="history-row" style="justify-content: flex-end; margin-top:5px;">
                <button onclick="clearHistory()" class="small-btn" style="background:#c0392b;" data-i18n="btn_clear">ğŸ—‘ï¸ Clear All</button>
            </div>
        </div>

        <div class="table-container">
            <table class="score-table">
                <thead><tr>
                    <th data-i18n="th_time">Time</th>
                    <th data-i18n="th_detail">Detail</th>
                    <th data-i18n="th_score">Score</th>
                </tr></thead>
                <tbody id="score-history-body"></tbody>
            </table>
        </div>
    </div>
</div> 
<div style="max-width: 1000px; margin: 30px auto; padding: 30px; background: #1a1a1a; color: #b0b0b0; border-radius: 10px; border: 1px solid #333; line-height: 1.8;">
    
    <h2 style="color: #f1c40f; border-bottom: 1px dashed #555; padding-bottom: 10px; margin-bottom: 20px;">About Type Master Global</h2>

    <div style="display: flex; flex-wrap: wrap; gap: 40px;">
        <div style="flex: 1; min-width: 300px;">
            <h3 style="color: #e0e0e0; margin-top: 0;">ğŸš€ Game Features</h3>
            <p>Type Master Global is a comprehensive web-based typing game designed to improve your typing speed and accuracy through gamified challenges. Unlike traditional typing tests, this game offers:</p>
            <ul style="padding-left: 20px;">
                <li><strong>Global Language Support:</strong> Practice in 11 different languages including English, Chinese, Japanese, Korean, and more.</li>
                <li><strong>52 Progressive Levels:</strong> Start with simple single-letter drops and progress to intense 52-character randomized storms.</li>
                <li><strong>Customizable Difficulty:</strong> Five speed settings ranging from "Turtle" to "Extreme".</li>
                <li><strong>Dual Modes:</strong> Choose "Challenge Mode" for ranked gameplay or "Practice Mode" for specific keys.</li>
            </ul>
        </div>

        <div style="flex: 1; min-width: 300px;">
            <h3 style="color: #e0e0e0; margin-top: 0;">ğŸ® How to Play</h3>
            <ol style="padding-left: 20px;">
                <li><strong>Select Your Settings:</strong> Choose your preferred language, level, and speed.</li>
                <li><strong>Defend the Line:</strong> Characters will fall from the top. Type the corresponding key before they hit the red <strong>"DEADLINE"</strong>.</li>
                <li><strong>Score Points:</strong> Each successful hit grants you points. Crossing the deadline counts as a miss.</li>
                <li><strong>Beat the Clock:</strong> You have 60 seconds to achieve the highest score possible.</li>
            </ol>
        </div>
    </div>

    <div style="margin-top: 30px; border-top: 1px solid #333; padding-top: 20px;">
        <h3 style="color: #e0e0e0;">ğŸ’¡ Benefits of Typing Practice</h3>
        <p>Regular practice with Type Master Global helps develop <strong>muscle memory</strong>, allowing you to type without looking at the keyboard (touch typing). Improving your typing speed can significantly boost productivity in work and study environments.</p>
    </div>
</div>


<div id="game-over-modal">
    <h2 style="color: #fff;" data-i18n="modal_title">Game Over</h2>
    <p><span data-i18n="modal_score">Final Score</span>: <span id="final-score" style="font-size: 3rem; color: #f1c40f; display:block; margin: 10px 0;"></span></p>
    <button onclick="closeModal()" style="background:#27ae60; color:white; border:none; padding: 10px 20px; cursor:pointer; font-size:1rem; border-radius:4px;" data-i18n="modal_close">Close</button>
</div>

<footer style="text-align:center; padding: 20px; font-size: 0.8rem; color: #555; width: 100%;">
    &copy; 2026 Type Master Global. <a href="privacy.html" style="color: #777;">Privacy Policy</a>
</footer>

<script>
    const translations = {
        "en": {
            tab_challenge: "ğŸ”¥ Challenge", tab_practice: "ğŸ› ï¸ Practice",
            lbl_level: "Level", lbl_extra: "Extra:", chk_digits: "Digits (0-9)", chk_symbols: "Symbols",
            lbl_practice_tip: "Enter characters to practice:", lbl_speed: "Speed",
            opt_speed_turtle: "ğŸ¢ Turtle", opt_speed_slow: "ğŸš¶ Slow", opt_speed_std: "ğŸƒ Standard", opt_speed_fast: "ğŸï¸ Fast", opt_speed_extreme: "ğŸš€ Extreme",
            btn_start: "Start Game", btn_stop: "â›” Stop",
            lbl_score: "Score", lbl_time: "Time",
            lbl_history: "ğŸ† History", lbl_sort: "Sort:", lbl_filter: "Filter Lv:", btn_clear: "ğŸ—‘ï¸ Clear",
            opt_sort_time: "ğŸ•’ Time", opt_sort_score: "ğŸ‘‘ Score", opt_sort_level: "ğŸ†™ Level",
            th_time: "Time", th_detail: "Detail", th_score: "Score",
            modal_title: "Game Over", modal_score: "Final Score", modal_close: "Close",
            msg_terminated: "Game Terminated.", msg_input_empty: "Please enter characters first!", msg_confirm_clear: "Clear all history?"
        },
        "zh-TW": {
            tab_challenge: "ğŸ”¥ æŒ‘æˆ°æ¨¡å¼", tab_practice: "ğŸ› ï¸ ç·´ç¿’æ¨¡å¼",
            lbl_level: "é—œå¡", lbl_extra: "é¡å¤–:", chk_digits: "æ•¸å­— (0-9)", chk_symbols: "ç¬¦è™Ÿ",
            lbl_practice_tip: "è¼¸å…¥ä½ æƒ³ç·´ç¿’çš„å­—ä¸²:", lbl_speed: "é€Ÿåº¦",
            opt_speed_turtle: "ğŸ¢ é¾œé€Ÿ", opt_speed_slow: "ğŸš¶ æ…¢é€Ÿ", opt_speed_std: "ğŸƒ æ¨™æº–", opt_speed_fast: "ğŸï¸ å¿«é€Ÿ", opt_speed_extreme: "ğŸš€ æ¥µé€Ÿ",
            btn_start: "é–‹å§‹éŠæˆ²", btn_stop: "â›” çµ‚æ­¢éŠæˆ²",
            lbl_score: "åˆ†æ•¸", lbl_time: "æ™‚é–“",
            lbl_history: "ğŸ† æ­·å²è¨˜éŒ„", lbl_sort: "æ’åº:", lbl_filter: "ç¯©é¸é—œå¡:", btn_clear: "ğŸ—‘ï¸ æ¸…é™¤",
            opt_sort_time: "ğŸ•’ æ™‚é–“", opt_sort_score: "ğŸ‘‘ åˆ†æ•¸", opt_sort_level: "ğŸ†™ é—œå¡",
            th_time: "æ™‚é–“", th_detail: "è©³æƒ…", th_score: "åˆ†æ•¸",
            modal_title: "éŠæˆ²çµæŸ", modal_score: "æœ€çµ‚åˆ†æ•¸", modal_close: "é—œé–‰",
            msg_terminated: "éŠæˆ²å·²çµ‚æ­¢ï¼Œä¸è¨˜éŒ„åˆ†æ•¸ã€‚", msg_input_empty: "è«‹å…ˆè¼¸å…¥è¦ç·´ç¿’çš„å­—æ¯ï¼", msg_confirm_clear: "ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰è¨˜éŒ„å—ï¼Ÿ"
        },
        "zh-CN": {
            tab_challenge: "ğŸ”¥ æŒ‘æˆ˜æ¨¡å¼", tab_practice: "ğŸ› ï¸ ç»ƒä¹ æ¨¡å¼",
            lbl_level: "å…³å¡", lbl_extra: "é¢å¤–:", chk_digits: "æ•°å­— (0-9)", chk_symbols: "ç¬¦å·",
            lbl_practice_tip: "è¾“å…¥ä½ æƒ³ç»ƒä¹ çš„å­—ç¬¦ä¸²:", lbl_speed: "é€Ÿåº¦",
            opt_speed_turtle: "ğŸ¢ é¾Ÿé€Ÿ", opt_speed_slow: "ğŸš¶ æ…¢é€Ÿ", opt_speed_std: "ğŸƒ æ ‡å‡†", opt_speed_fast: "ğŸï¸ å¿«é€Ÿ", opt_speed_extreme: "ğŸš€ æé€Ÿ",
            btn_start: "å¼€å§‹æ¸¸æˆ", btn_stop: "â›” ç»ˆæ­¢æ¸¸æˆ",
            lbl_score: "åˆ†æ•°", lbl_time: "æ—¶é—´",
            lbl_history: "ğŸ† å†å²è®°å½•", lbl_sort: "æ’åº:", lbl_filter: "ç­›é€‰å…³å¡:", btn_clear: "ğŸ—‘ï¸ æ¸…é™¤",
            opt_sort_time: "ğŸ•’ æ—¶é—´", opt_sort_score: "ğŸ‘‘ åˆ†æ•°", opt_sort_level: "ğŸ†™ å…³å¡",
            th_time: "æ—¶é—´", th_detail: "è¯¦æƒ…", th_score: "åˆ†æ•°",
            modal_title: "æ¸¸æˆç»“æŸ", modal_score: "æœ€ç»ˆåˆ†æ•°", modal_close: "å…³é—­",
            msg_terminated: "æ¸¸æˆå·²ç»ˆæ­¢ã€‚", msg_input_empty: "è¯·å…ˆè¾“å…¥è¦ç»ƒä¹ çš„å­—æ¯ï¼", msg_confirm_clear: "ç¡®å®šè¦åˆ é™¤æ‰€æœ‰è®°å½•å—ï¼Ÿ"
        },
        "ja": {
            tab_challenge: "ğŸ”¥ ãƒãƒ£ãƒ¬ãƒ³ã‚¸", tab_practice: "ğŸ› ï¸ ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰",
            lbl_level: "ãƒ¬ãƒ™ãƒ«", lbl_extra: "è¿½åŠ :", chk_digits: "æ•°å­— (0-9)", chk_symbols: "è¨˜å·",
            lbl_practice_tip: "ç·´ç¿’ã—ãŸã„æ–‡å­—ã‚’å…¥åŠ›:", lbl_speed: "é€Ÿåº¦",
            opt_speed_turtle: "ğŸ¢ äº€", opt_speed_slow: "ğŸš¶ é…ã„", opt_speed_std: "ğŸƒ æ™®é€š", opt_speed_fast: "ğŸï¸ é€Ÿã„", opt_speed_extreme: "ğŸš€ æ¥µé™",
            btn_start: "ã‚¹ã‚¿ãƒ¼ãƒˆ", btn_stop: "â›” ä¸­æ­¢",
            lbl_score: "ã‚¹ã‚³ã‚¢", lbl_time: "æ®‹ã‚Šæ™‚é–“",
            lbl_history: "ğŸ† å±¥æ­´", lbl_sort: "ä¸¦æ›¿:", lbl_filter: "Lvæ¤œç´¢:", btn_clear: "ğŸ—‘ï¸ å‰Šé™¤",
            opt_sort_time: "ğŸ•’ æ—¥æ™‚", opt_sort_score: "ğŸ‘‘ ã‚¹ã‚³ã‚¢", opt_sort_level: "ğŸ†™ ãƒ¬ãƒ™ãƒ«",
            th_time: "æ—¥æ™‚", th_detail: "è©³ç´°", th_score: "ã‚¹ã‚³ã‚¢",
            modal_title: "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼", modal_score: "æœ€çµ‚ã‚¹ã‚³ã‚¢", modal_close: "é–‰ã˜ã‚‹",
            msg_terminated: "ã‚²ãƒ¼ãƒ ã‚’ä¸­æ­¢ã—ã¾ã—ãŸã€‚", msg_input_empty: "æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼", msg_confirm_clear: "å±¥æ­´ã‚’å…¨æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ"
        },
        "ko": {
            tab_challenge: "ğŸ”¥ ì±Œë¦°ì§€", tab_practice: "ğŸ› ï¸ ì—°ìŠµ ëª¨ë“œ",
            lbl_level: "ë ˆë²¨", lbl_extra: "ì¶”ê°€:", chk_digits: "ìˆ«ì (0-9)", chk_symbols: "ê¸°í˜¸",
            lbl_practice_tip: "ì—°ìŠµí•  ë¬¸ìë¥¼ ì…ë ¥:", lbl_speed: "ì†ë„",
            opt_speed_turtle: "ğŸ¢ ê±°ë¶ì´", opt_speed_slow: "ğŸš¶ ëŠë¦¼", opt_speed_std: "ğŸƒ ë³´í†µ", opt_speed_fast: "ğŸï¸ ë¹ ë¦„", opt_speed_extreme: "ğŸš€ ê·¹í•œ",
            btn_start: "ê²Œì„ ì‹œì‘", btn_stop: "â›” ì¤‘ì§€",
            lbl_score: "ì ìˆ˜", lbl_time: "ì‹œê°„",
            lbl_history: "ğŸ† ê¸°ë¡", lbl_sort: "ì •ë ¬:", lbl_filter: "Lv í•„í„°:", btn_clear: "ğŸ—‘ï¸ ì‚­ì œ",
            opt_sort_time: "ğŸ•’ ì‹œê°„", opt_sort_score: "ğŸ‘‘ ì ìˆ˜", opt_sort_level: "ğŸ†™ ë ˆë²¨",
            th_time: "ì‹œê°„", th_detail: "ìƒì„¸", th_score: "ì ìˆ˜",
            modal_title: "ê²Œì„ ì¢…ë£Œ", modal_score: "ìµœì¢… ì ìˆ˜", modal_close: "ë‹«ê¸°",
            msg_terminated: "ê²Œì„ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.", msg_input_empty: "ë¬¸ìë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”!", msg_confirm_clear: "ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
        },
        "es": {
            tab_challenge: "ğŸ”¥ DesafÃ­o", tab_practice: "ğŸ› ï¸ PrÃ¡ctica",
            lbl_level: "Nivel", lbl_extra: "Extra:", chk_digits: "DÃ­gitos (0-9)", chk_symbols: "SÃ­mbolos",
            lbl_practice_tip: "Ingresa caracteres:", lbl_speed: "Velocidad",
            opt_speed_turtle: "ğŸ¢ Tortuga", opt_speed_slow: "ğŸš¶ Lento", opt_speed_std: "ğŸƒ Normal", opt_speed_fast: "ğŸï¸ RÃ¡pido", opt_speed_extreme: "ğŸš€ Extremo",
            btn_start: "Iniciar", btn_stop: "â›” Detener",
            lbl_score: "Puntos", lbl_time: "Tiempo",
            lbl_history: "ğŸ† Historial", lbl_sort: "Orden:", lbl_filter: "Filtro Lv:", btn_clear: "ğŸ—‘ï¸ Borrar",
            opt_sort_time: "ğŸ•’ Fecha", opt_sort_score: "ğŸ‘‘ Puntos", opt_sort_level: "ğŸ†™ Nivel",
            th_time: "Fecha", th_detail: "Detalle", th_score: "Puntos",
            modal_title: "Juego Terminado", modal_score: "PuntuaciÃ³n Final", modal_close: "Cerrar",
            msg_terminated: "Juego terminado.", msg_input_empty: "Â¡Ingresa caracteres!", msg_confirm_clear: "Â¿Borrar historial?"
        },
        "de": {
            tab_challenge: "ğŸ”¥ Herausforderung", tab_practice: "ğŸ› ï¸ Ãœbung",
            lbl_level: "Stufe", lbl_extra: "Extra:", chk_digits: "Ziffern (0-9)", chk_symbols: "Symbole",
            lbl_practice_tip: "Zeichen eingeben:", lbl_speed: "Tempo",
            opt_speed_turtle: "ğŸ¢ SchildkrÃ¶te", opt_speed_slow: "ğŸš¶ Langsam", opt_speed_std: "ğŸƒ Standard", opt_speed_fast: "ğŸï¸ Schnell", opt_speed_extreme: "ğŸš€ Extrem",
            btn_start: "Starten", btn_stop: "â›” Stoppen",
            lbl_score: "Punkte", lbl_time: "Zeit",
            lbl_history: "ğŸ† Verlauf", lbl_sort: "Sort:", lbl_filter: "Lv Filter:", btn_clear: "ğŸ—‘ï¸ Leeren",
            opt_sort_time: "ğŸ•’ Zeit", opt_sort_score: "ğŸ‘‘ Punkte", opt_sort_level: "ğŸ†™ Stufe",
            th_time: "Zeit", th_detail: "Details", th_score: "Punkte",
            modal_title: "Spiel Vorbei", modal_score: "Endpunktzahl", modal_close: "SchlieÃŸen",
            msg_terminated: "Spiel beendet.", msg_input_empty: "Bitte Zeichen eingeben!", msg_confirm_clear: "Verlauf lÃ¶schen?"
        },
        "fr": {
            tab_challenge: "ğŸ”¥ DÃ©fi", tab_practice: "ğŸ› ï¸ Pratique",
            lbl_level: "Niveau", lbl_extra: "Extra:", chk_digits: "Chiffres (0-9)", chk_symbols: "Symboles",
            lbl_practice_tip: "Entrez des caractÃ¨res:", lbl_speed: "Vitesse",
            opt_speed_turtle: "ğŸ¢ Tortue", opt_speed_slow: "ğŸš¶ Lent", opt_speed_std: "ğŸƒ Standard", opt_speed_fast: "ğŸï¸ Rapide", opt_speed_extreme: "ğŸš€ ExtrÃªme",
            btn_start: "DÃ©marrer", btn_stop: "â›” ArrÃªter",
            lbl_score: "Score", lbl_time: "Temps",
            lbl_history: "ğŸ† Historique", lbl_sort: "Trier:", lbl_filter: "Filtrer Lv:", btn_clear: "ğŸ—‘ï¸ Effacer",
            opt_sort_time: "ğŸ•’ Date", opt_sort_score: "ğŸ‘‘ Score", opt_sort_level: "ğŸ†™ Niveau",
            th_time: "Date", th_detail: "DÃ©tail", th_score: "Score",
            modal_title: "Jeu TerminÃ©", modal_score: "Score Final", modal_close: "Fermer",
            msg_terminated: "Jeu arrÃªtÃ©.", msg_input_empty: "Entrez des caractÃ¨res!", msg_confirm_clear: "Effacer l'historique?"
        },
        "pt": {
            tab_challenge: "ğŸ”¥ Desafio", tab_practice: "ğŸ› ï¸ PrÃ¡tica",
            lbl_level: "NÃ­vel", lbl_extra: "Extra:", chk_digits: "DÃ­gitos (0-9)", chk_symbols: "SÃ­mbolos",
            lbl_practice_tip: "Digite os caracteres:", lbl_speed: "Velocidade",
            opt_speed_turtle: "ğŸ¢ Tartaruga", opt_speed_slow: "ğŸš¶ Lento", opt_speed_std: "ğŸƒ PadrÃ£o", opt_speed_fast: "ğŸï¸ RÃ¡pido", opt_speed_extreme: "ğŸš€ Extremo",
            btn_start: "Iniciar", btn_stop: "â›” Parar",
            lbl_score: "Pontos", lbl_time: "Tempo",
            lbl_history: "ğŸ† HistÃ³rico", lbl_sort: "Ordem:", lbl_filter: "Filtrar Lv:", btn_clear: "ğŸ—‘ï¸ Limpar",
            opt_sort_time: "ğŸ•’ Data", opt_sort_score: "ğŸ‘‘ Pontos", opt_sort_level: "ğŸ†™ NÃ­vel",
            th_time: "Data", th_detail: "Detalhe", th_score: "Pontos",
            modal_title: "Fim de Jogo", modal_score: "PontuaÃ§Ã£o", modal_close: "Fechar",
            msg_terminated: "Jogo terminado.", msg_input_empty: "Digite caracteres!", msg_confirm_clear: "Limpar histÃ³rico?"
        },
        "ru": {
            tab_challenge: "ğŸ”¥ Ğ’Ñ‹Ğ·Ğ¾Ğ²", tab_practice: "ğŸ› ï¸ ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºĞ°",
            lbl_level: "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ", lbl_extra: "Ğ”Ğ¾Ğ¿:", chk_digits: "Ğ¦Ğ¸Ñ„Ñ€Ñ‹ (0-9)", chk_symbols: "Ğ¡Ğ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹",
            lbl_practice_tip: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹:", lbl_speed: "Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ",
            opt_speed_turtle: "ğŸ¢ Ğ§ĞµÑ€ĞµĞ¿Ğ°Ñ…Ğ°", opt_speed_slow: "ğŸš¶ ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾", opt_speed_std: "ğŸƒ ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾", opt_speed_fast: "ğŸï¸ Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾", opt_speed_extreme: "ğŸš€ Ğ­ĞºÑÑ‚Ñ€Ğ¸Ğ¼",
            btn_start: "Ğ¡Ñ‚Ğ°Ñ€Ñ‚", btn_stop: "â›” Ğ¡Ñ‚Ğ¾Ğ¿",
            lbl_score: "Ğ¡Ñ‡ĞµÑ‚", lbl_time: "Ğ’Ñ€ĞµĞ¼Ñ",
            lbl_history: "ğŸ† Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ", lbl_sort: "Ğ¡Ğ¾Ñ€Ñ‚:", lbl_filter: "Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Lv:", btn_clear: "ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ",
            opt_sort_time: "ğŸ•’ Ğ’Ñ€ĞµĞ¼Ñ", opt_sort_score: "ğŸ‘‘ Ğ¡Ñ‡ĞµÑ‚", opt_sort_level: "ğŸ†™ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ",
            th_time: "Ğ’Ñ€ĞµĞ¼Ñ", th_detail: "Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸", th_score: "Ğ¡Ñ‡ĞµÑ‚",
            modal_title: "ĞšĞ¾Ğ½ĞµÑ† Ğ¸Ğ³Ñ€Ñ‹", modal_score: "Ğ˜Ñ‚Ğ¾Ğ³", modal_close: "Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ",
            msg_terminated: "Ğ˜Ğ³Ñ€Ğ° Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½Ğ°.", msg_input_empty: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹!", msg_confirm_clear: "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ?"
        },
        "th": {
            tab_challenge: "ğŸ”¥ à¸„à¸§à¸²à¸¡à¸—à¹‰à¸²à¸—à¸²à¸¢", tab_practice: "ğŸ› ï¸ à¸à¸¶à¸à¸à¸™",
            lbl_level: "à¸£à¸°à¸”à¸±à¸š", lbl_extra: "à¸à¸´à¹€à¸¨à¸©:", chk_digits: "à¸•à¸±à¸§à¹€à¸¥à¸‚ (0-9)", chk_symbols: "à¸ªà¸±à¸à¸¥à¸±à¸à¸©à¸“à¹Œ",
            lbl_practice_tip: "à¸›à¹‰à¸­à¸™à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£à¹€à¸à¸·à¹ˆà¸­à¸à¸¶à¸:", lbl_speed: "à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§",
            opt_speed_turtle: "ğŸ¢ à¹€à¸•à¹ˆà¸²", opt_speed_slow: "ğŸš¶ à¸Šà¹‰à¸²", opt_speed_std: "ğŸƒ à¸›à¸à¸•à¸´", opt_speed_fast: "ğŸï¸ à¹€à¸£à¹‡à¸§", opt_speed_extreme: "ğŸš€ à¸ªà¸¸à¸”à¸‚à¸µà¸”",
            btn_start: "à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡", btn_stop: "â›” à¸«à¸¢à¸¸à¸”à¹€à¸à¸¡",
            lbl_score: "à¸„à¸°à¹à¸™à¸™", lbl_time: "à¹€à¸§à¸¥à¸²",
            lbl_history: "ğŸ† à¸›à¸£à¸°à¸§à¸±à¸•à¸´", lbl_sort: "à¹€à¸£à¸µà¸¢à¸‡:", lbl_filter: "à¸à¸£à¸­à¸‡ Lv:", btn_clear: "ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡",
            opt_sort_time: "ğŸ•’ à¹€à¸§à¸¥à¸²", opt_sort_score: "ğŸ‘‘ à¸„à¸°à¹à¸™à¸™", opt_sort_level: "ğŸ†™ à¸£à¸°à¸”à¸±à¸š",
            th_time: "à¹€à¸§à¸¥à¸²", th_detail: "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”", th_score: "à¸„à¸°à¹à¸™à¸™",
            modal_title: "à¸ˆà¸šà¹€à¸à¸¡", modal_score: "à¸„à¸°à¹à¸™à¸™à¸£à¸§à¸¡", modal_close: "à¸›à¸´à¸”",
            msg_terminated: "à¸«à¸¢à¸¸à¸”à¹€à¸à¸¡à¹à¸¥à¹‰à¸§", msg_input_empty: "à¸à¸£à¸¸à¸“à¸²à¸›à¹‰à¸­à¸™à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£à¸à¹ˆà¸­à¸™!", msg_confirm_clear: "à¸¥à¹‰à¸²à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”?"
        }
    };

    let currentLang = localStorage.getItem('game_lang') || 'en';
    const CHARS_LETTERS = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const CHARS_DIGITS = "0123456789";
    const CHARS_SYMBOLS = "!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";

    document.addEventListener('DOMContentLoaded', function() {
        const levelSelect = document.getElementById('level-select');
        for (let i = 1; i <= 52; i++) {
            let opt = document.createElement('option');
            opt.value = i;
            opt.innerHTML = "Level " + i;
            levelSelect.appendChild(opt);
        }
        document.getElementById('lang-selector').value = currentLang;
        applyLanguage(currentLang);
        renderHistory();
    });

    let currentMode = 'challenge';
    let gameState = {
        active: false, score: 0, timeLeft: 60,
        pool: [], letters: [], speed: 3, lastSpawnTime: 0, spawnInterval: 800,
        animationFrameId: null, timerId: null
    };

    const gameArea = document.getElementById('game-area');

    function changeLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('game_lang', lang);
        applyLanguage(lang);
    }

    function applyLanguage(lang) {
        const t = translations[lang];
        if (!t) return;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (t[key]) {
                if(el.tagName === 'INPUT' && el.type === 'text') {
                    el.placeholder = t[key];
                } else {
                    el.innerText = t[key];
                }
            }
        });
        const levelSelect = document.getElementById('level-select');
        const levelText = t['lbl_level'] || "Level";
        for(let opt of levelSelect.options) {
            opt.text = `${levelText} ${opt.value}`;
        }
    }

    function switchMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.mode-content').forEach(d => d.classList.remove('active'));
        if(mode === 'challenge') {
            document.getElementById('tab-challenge').classList.add('active');
            document.getElementById('panel-challenge').classList.add('active');
        } else {
            document.getElementById('tab-practice').classList.add('active');
            document.getElementById('panel-practice').classList.add('active');
            setTimeout(() => document.getElementById('custom-chars').focus(), 100);
        }
    }

    function getTrans(key) {
        return translations[currentLang][key] || translations['en'][key];
    }

    function startGame() {
        if (gameState.active) return;
        let customInput = document.getElementById('custom-chars').value;
        if (currentMode === 'practice' && customInput.trim() === '') {
            alert(getTrans('msg_input_empty'));
            document.getElementById('custom-chars').focus();
            return;
        }
        resetGameUI();
        closeModal();
        document.getElementById('btn-start').style.display = 'none';
        document.getElementById('btn-stop').style.display = 'block';
        gameState.speed = parseFloat(document.getElementById('speed-select').value);
        gameState.spawnInterval = 1000 - (gameState.speed * 80); 
        if (gameState.spawnInterval < 200) gameState.spawnInterval = 200;
        gameState.pool = generatePool();
        if (!gameState.pool || gameState.pool.length === 0) {
            alert("Error: Pool empty");
            stopGame();
            return;
        }
        gameState.active = true;
        gameState.timerId = setInterval(() => {
            gameState.timeLeft--;
            document.getElementById('time-left').innerText = gameState.timeLeft;
            if (gameState.timeLeft <= 0) {
                endGame(true);
            }
        }, 1000);
        requestAnimationFrame(gameLoop);
    }

    function generatePool() {
        let pool = [];
        if (currentMode === 'practice') {
            let input = document.getElementById('custom-chars').value;
            pool = Array.from(new Set(input.split(''))).filter(c => c.trim() !== '');
        } else {
            let source = CHARS_LETTERS;
            if(document.getElementById('chk-digits').checked) source += CHARS_DIGITS;
            if(document.getElementById('chk-symbols').checked) source += CHARS_SYMBOLS;
            let level = parseInt(document.getElementById('level-select').value);
            let sampleSize = Math.min(level, source.length);
            let sourceArray = source.split('');
            let result = [];
            for (let i = 0; i < sampleSize; i++) {
                let idx = Math.floor(Math.random() * sourceArray.length);
                result.push(sourceArray[idx]);
                sourceArray.splice(idx, 1);
            }
            pool = result;
        }
        return pool;
    }

    function stopGame() {
        if (!gameState.active) return;
        gameState.active = false;
        clearInterval(gameState.timerId);
        cancelAnimationFrame(gameState.animationFrameId);
        document.querySelectorAll('.falling-char').forEach(e => e.remove());
        document.getElementById('btn-start').style.display = 'block';
        document.getElementById('btn-stop').style.display = 'none';
        resetGameUI();
        alert(getTrans('msg_terminated'));
    }

    function endGame(saveRecord) {
        gameState.active = false;
        clearInterval(gameState.timerId);
        cancelAnimationFrame(gameState.animationFrameId);
        document.getElementById('btn-start').style.display = 'block';
        document.getElementById('btn-stop').style.display = 'none';
        document.getElementById('final-score').innerText = gameState.score;
        document.getElementById('game-over-modal').style.display = 'block';
        if (saveRecord && currentMode === 'challenge') {
            saveScore(document.getElementById('level-select').value, gameState.score);
        }
    }

    function resetGameUI() {
        gameState.score = 0;
        gameState.timeLeft = 60;
        gameState.letters = [];
        gameState.lastSpawnTime = 0;
        document.getElementById('current-score').innerText = "0";
        document.getElementById('time-left').innerText = "60";
        document.querySelectorAll('.falling-char').forEach(e => e.remove());
    }

    function gameLoop(timestamp) {
        if (!gameState.active) return;
        if (timestamp - gameState.lastSpawnTime > gameState.spawnInterval) {
            spawnRandomChar();
            gameState.lastSpawnTime = timestamp + (Math.random() * 200); 
        }
        const limit = gameArea.clientHeight - 60; 
        gameState.letters.forEach(obj => {
            if (obj.y < gameArea.clientHeight) {
                obj.y += gameState.speed;
                obj.el.style.top = obj.y + 'px';
                if (obj.active && obj.y >= limit) {
                    obj.active = false;
                    obj.el.classList.add('missed');
                }
            } else {
                if (obj.el.parentNode) obj.el.remove();
            }
        });
        gameState.letters = gameState.letters.filter(obj => obj.y < gameArea.clientHeight);
        gameState.animationFrameId = requestAnimationFrame(gameLoop);
    }

    function spawnRandomChar() {
        if (gameState.pool.length === 0) return;
        const char = gameState.pool[Math.floor(Math.random() * gameState.pool.length)];
        const el = document.createElement('div');
        el.className = 'falling-char';
        el.innerText = char;
        const maxX = gameArea.clientWidth - 40; 
        el.style.left = (Math.random() * maxX) + 'px';
        el.style.top = '-40px';
        gameArea.appendChild(el);
        gameState.letters.push({ char: char, el: el, y: -40, active: true });
    }

    window.addEventListener('keydown', (e) => {
        if (!gameState.active) return;
        if (e.key.length !== 1) return;
        let targetIndex = -1, maxY = -9999;
        gameState.letters.forEach((obj, index) => {
            if (obj.active && obj.char === e.key && obj.y > maxY) {
                maxY = obj.y; targetIndex = index;
            }
        });
        if (targetIndex !== -1) {
            gameState.letters[targetIndex].el.remove(); 
            gameState.letters.splice(targetIndex, 1);
            gameState.score += 10;
            document.getElementById('current-score').innerText = gameState.score;
        }
    });

    function saveScore(level, score) {
        if (score === 0) return;
        let history = JSON.parse(localStorage.getItem('letterGame_history_v2') || '[]');
        const now = new Date();
        const dateStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
        let speedLabel = document.getElementById('speed-select').options[document.getElementById('speed-select').selectedIndex].getAttribute('data-i18n');
        let speedText = getTrans(speedLabel) || "Standard";
        let typeInfo = "Lv." + level;
        if(document.getElementById('chk-digits').checked) typeInfo += "+Num";
        if(document.getElementById('chk-symbols').checked) typeInfo += "+Sym";
        history.push({ ts: Date.now(), date: dateStr, levelNum: parseInt(level), levelStr: typeInfo, speed: speedText, score: score });
        localStorage.setItem('letterGame_history_v2', JSON.stringify(history));
        renderHistory();
    }

    function validateInput(el) {
        if(el.value === "") return;
        let val = parseInt(el.value);
        if(val < 1) el.value = 1;
        if(val > 52) el.value = 52;
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem('letterGame_history_v2') || '[]');
        const tbody = document.getElementById('score-history-body');
        const sortKey = document.getElementById('hist-sort').value;
        const filterLv = document.getElementById('hist-filter-lv').value;
        tbody.innerHTML = '';
        let displayData = history.filter(item => {
            if(filterLv && item.levelNum !== parseInt(filterLv)) return false;
            return true;
        });
        displayData.sort((a, b) => {
            if (sortKey === 'score') return b.score - a.score;
            if (sortKey === 'level') return b.levelNum - a.levelNum;
            return b.ts - a.ts;
        });
        displayData.slice(0, 50).forEach(rec => {
            let row = `<tr><td>${rec.date}</td><td><span style="font-weight:bold;">${rec.levelStr}</span><span class="tag spd">${rec.speed}</span></td><td style="color:#f1c40f; font-weight:bold; font-size:1.1rem;">${rec.score}</td></tr>`;
            tbody.innerHTML += row;
        });
        if(displayData.length === 0) tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; color:#555;">...</td></tr>';
    }

    function clearHistory() {
        if(confirm(getTrans('msg_confirm_clear'))) {
            localStorage.removeItem('letterGame_history_v2');
            renderHistory();
        }
    }
    function closeModal() { document.getElementById('game-over-modal').style.display = 'none'; }
</script>
</body>

</html>

